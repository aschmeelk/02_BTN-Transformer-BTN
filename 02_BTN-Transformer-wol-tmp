NullAsValue REJECT_DATE, XRAY_PASS, REJECT_POST_NAME;
Set NullValue = 'NULL';

trace ;
trace ----- gra_work_order_line tmp -----;

gra_work_order_line_tmp:
LOAD
//---------- Keys ------------------
  Dealer,
  WORK_ORDER_LINE_KEY,
  WORK_ORDER_HEADER_KEY,
  WORK_ORDER_HEADER_KEY 			AS WORK_ORDER_HEADER_KEY2,
  RFID_TAG_KEY,
  PROD_CUSTOMER_KEY,
  PROD_CUSTOMER_KEY								AS CUSTOMER_INFO_SETTINGS_KEY,
  CASING_MAKE_KEY,
  TREAD_DESC_KEY,
  TREAD_DIMENSION_KEY,
  CASING_SERIES_KEY,
  CASING_SIZE_KEY,
  ADJUSTMENT_REASON_KEY,
  TREAD_LENGTH_KEY,
  REJECT_REASON_KEY,
  TREAD_WIDTH_KEY,
  SC_Reject_Reason_FK,
  ORIGINAL_CUSTOMER_FK,
  TIRE_AXLE  					as REFERENCE_INFORMATION_KEY,
  TIRE_APPLICATION              as REFERENCE_INFORMATION_PK,
  USER_KEY,
  CASING_GRADE_PK,
  SC_REJECT_REASON_FK,
  WHEEL_COLOR_FK,
  WHEEL_TYPE_FK,
  OVERRIDE_GRADE_FK,
  
 //---------- Fields ------------------
  LINE_NUM,
  CASING_ID				 as Tag,
  Dealer &'|'& CASING_ID as CASING_ID,
  CASING_ID_DESC,
  MFG_DOT,
  RT_DOT,
  NTR,
  BRAND_NUM,
  CASING_STATUS,
  T_NOTE,
  REPAIR_IND,
  AGE,
  TREAD_DEPTH,
  REMAINING_DEPTH,
  ADJ_PERCENT,
  DEF_ADJ_PERCENT,
  BUFF_CIRCUM,
  IS_WITH_REPAIR,
  WARRANTY_CASING,
  WARRANTY_REPAIRS,
  TREAD_LOT_NUM,
  TREAD_SERIAL_NUM,
  BUILT_CIRCUM,
  CHAMBER_NUM,
  SEQUENCE_NUM,
  CURING_RESULTS,
  READY_FOR_RELEASE,
  RERUN_IND,
  DISPOSITION,
  PROCESS_CODE,
  COMPLETE_DT,
  OPERATOR_ID,
  REPAIRS_DONE,
  TREAD_APPLIED,
  
  POST_MARKER,
  TREAD_PREPARATION_STATUS,
  BUFF_PROGRAM,
  INSPECT_ONLY_RESULT_FLAG,
  BUFF_WIDTH,
  WORK_TYPE,
  SKIVE_COUNT,
  NUM_OF_SKIVES,
  CASING_ADVANCE_TIMER,
  ADVANCED,
  SEND_TO_SERVICE_POST,
  DATE_OUT_OF_SERVICE,
  SHIPPING_LOCATION,
  REJECT_POST_NAME,
  REJECT_DATE,
  if(isnull(REJECT_DATE),0,1) as %Flag_Rejected,
  REJECT_IND,
  EXPORT_RM,
  EXPORT_FG,
  CUST_TYPE,
  CIA,
  PAST_BUFFER,
  BUFFERED,
  ADVANCED_FROM_BUILDER,
  PACK_LIST_FK,
  RUBBER_THICKNESS,
  ADJUSTMENT_NOTES,
  ADJUSTMENT_RW,
  MOLD_TYPE,
  XRAY_PASS,
  XRAY_IND,
  CCCP_WO_MOVED,
  CCCP_BUILD_FOR_STOCK,
  `Avg Tread Depth`,
  TREAD_DEPTH1,
  TREAD_DEPTH2,
  TREAD_DEPTH3,
  TREAD_DEPTH4,
  INVENTORY_DECREMENT,
  LENGTH_CONSUPTION,
  CTC_CONSUPTION,
  LAST_SCAN_AT,
  LOCK_TIME,
  LOCK_USER,
  LOCK_POST,
  ENVELOPE,
  INNER_LOPE,
  CREATION_DATE,
  num(CREATION_DATE) as  CREATION_DATE2,
  DELETION_DATE,
  WAS_REJECTED,
  IGNORE_CHECK_CAM_SPEC_NTR,
  IGNORE_CHECK_CAM_SPEC_AGE,
  IGNORE_CHECK_CAM_SPEC_REP,
  POS_INTERFACE_ID1,
  POS_INTERFACE_ID2,
  CTC_APPLIED,
  CTC_LOT_NUM,
  CASING_VALUE,
  CEMENT_GLUE_LOT_NUM,
  REPAIR_GUM_LOT_NUM
FROM [$(LibConnection)gra_work_order_line_$(vDealer).qvd]
(qvd)
where Exists(WORK_ORDER_HEADER_KEY, WORK_ORDER_HEADER_KEY)
//where floor(CREATION_DATE) >=  $(vYearMinus3)
//and floor(CREATION_DATE) <=  $(vCurrentDate)
  
;


 Left Join  (gra_work_order_line_tmp)
LOAD
    REFERENCE_INFORMATION_KEY ,
    REFERENCE_VALUE_ID  AS TIRE_AXLE
FROM [$(LibConnection)gra_reference_information_$(vDealer).qvd]
(qvd);


 Left Join  (gra_work_order_line_tmp)
LOAD
    REFERENCE_INFORMATION_KEY 	AS REFERENCE_INFORMATION_PK,
    REFERENCE_VALUE_ID  		AS TIRE_APPLICATION
FROM [$(LibConnection)gra_reference_information_$(vDealer).qvd]
(qvd);

 Left Join  (gra_work_order_line_tmp)
LOAD
    User_Key					AS USER_KEY,
    LOGIN						AS REJECT_USER_LOGIN
FROM [$(LibConnection)gra_user_$(vDealer).qvd]
(qvd);

 Left Join  (gra_work_order_line_tmp)
LOAD
    CASING_GRADE_KEY    AS CASING_GRADE_PK,
    CASING_GRADE		AS SYS_CASING_GRADE
FROM [$(LibConnection)gra_casing_grade_$(vDealer).qvd]
(qvd);

 Left Join  (gra_work_order_line_tmp)
LOAD
    CASING_GRADE_KEY    AS OVERRIDE_GRADE_FK,
    CASING_GRADE		AS OVERRIDE_CASING_GRADE
FROM [$(LibConnection)gra_casing_grade_$(vDealer).qvd]
(qvd);

 Left Join  (gra_work_order_line_tmp)
LOAD
    REFERENCE_INFORMATION_KEY	AS WHEEL_TYPE_FK,
    REFERENCE_DESCRIPTION 		AS WHEEL_TYPE
FROM [$(LibConnection)gra_reference_information_$(vDealer).qvd]
(qvd);

 Left Join  (gra_work_order_line_tmp)
LOAD
    REFERENCE_INFORMATION_KEY	AS WHEEL_COLOR_FK,
    REFERENCE_DESCRIPTION		AS WHEEL_COLOR
FROM [$(LibConnection)gra_reference_information_$(vDealer).qvd]
(qvd);

 Left Join  (gra_work_order_line_tmp)
LOAD
    CUSTOMER_INFO_SETTINGS_PK   AS ORIGINAL_CUSTOMER_FK,
    CODE						AS ORIGINAL_CUSTOMER_CODE,
    CUSTOMER_NAME				AS ORIGINAL_CUSTOMER_NAME
FROM [$(LibConnection)gra_customer_info_settings_$(vDealer).qvd]
(qvd);

 Left Join  (gra_work_order_line_tmp)
LOAD
    REJECT_REASON_PK AS SC_REJECT_REASON_FK,
    REJECT_REASON
FROM [$(LibConnection)gra_reject_reason_$(vDealer).qvd]
(qvd);





